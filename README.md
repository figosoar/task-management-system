# 任务管理系统

一个现代化的任务管理应用，具有用户登录、分栏管理、管理员后台和时间统计功能。

## 功能特性

### 👤 用户系统
- 用户注册时可设置显示名称（可选）
- 个性化的用户欢迎界面
- 角色权限控制（管理员/普通用户）

### 📋 任务管理
- **三栏式看板**: 待执行任务、执行中、已完成
- **拖拽操作**: 支持任务在不同列之间拖拽移动
- **优先级设置**: 低、中、高、紧急四个优先级
- **任务详情**: 标题、描述、优先级、创建时间
- **智能折叠**: 每列超过6个任务时，多余部分自动折叠，可点击展开

### 🛡️ 管理员系统
- **用户管理**: 创建、删除用户账户
- **任务分发**: 管理员可以给普通用户分配任务
- **数据统计**: 
  - 每日完成任务统计（最近7天）
  - 用户任务完成情况统计
  - 实时查看所有用户的任务状态
- **独立后台**: 专门的管理员后台界面

### ⏱️ 时间统计
- 实时显示未完成任务数量
- 计算并显示最长停留时间
- 任务创建时间追踪
- 完成时间记录

### 🔐 安全特性
- 安全的用户注册和登录
- 密码加密存储（bcrypt）
- 会话管理
- 角色权限控制

## 默认管理员账户

系统已预设管理员账户：
- **用户名**: `admin`
- **密码**: `admin123`
- **显示名称**: 系统管理员

## 技术栈

- **后端**: Node.js + Express
- **数据库**: SQLite3
- **前端**: 原生 JavaScript + CSS3
- **认证**: bcryptjs + express-session

## 安装和运行

1. 安装依赖:
```bash
npm install
```

2. 启动应用:
```bash
npm start
```

3. 开发模式 (自动重启):
```bash
npm run dev
```

4. 访问应用:
- 主应用: `http://localhost:3000`
- 管理后台: `http://localhost:3000/admin.html`

## 项目结构

```
avengers-todo/
├── server.js              # 后端服务器
├── package.json           # 项目配置
├── avengers_todo.db       # SQLite数据库 (自动生成)
├── public/
│   ├── index.html         # 主页面
│   ├── admin.html         # 管理员后台页面
│   ├── styles.css         # 主样式文件
│   ├── admin.css          # 管理员后台样式
│   ├── app.js            # 前端JavaScript
│   └── admin.js          # 管理员后台JavaScript
└── README.md             # 项目说明
```

## API 接口

### 用户相关
- `POST /api/register` - 用户注册
- `POST /api/login` - 用户登录
- `GET /api/user` - 获取当前用户信息
- `POST /api/logout` - 用户登出

### 任务相关
- `GET /api/todos` - 获取用户任务列表
- `POST /api/todos` - 创建新任务
- `PUT /api/todos/:id` - 更新任务
- `DELETE /api/todos/:id` - 删除任务

### 管理员接口（需要管理员权限）
- `GET /api/admin/users` - 获取所有用户列表
- `POST /api/admin/users` - 创建新用户
- `DELETE /api/admin/users/:id` - 删除用户
- `GET /api/admin/todos` - 获取所有任务
- `GET /api/admin/stats/daily` - 获取每日完成任务统计
- `GET /api/admin/stats/users` - 获取用户任务统计

## 使用说明

### 普通用户
1. **注册账号**: 输入用户名、密码，可选设置显示名称
2. **创建任务**: 点击各列的 "+" 按钮创建任务
3. **管理任务**: 
   - 点击任务卡片上的编辑按钮修改任务
   - 点击删除按钮删除任务
   - 拖拽任务卡片在不同列之间移动
4. **查看统计**: 底部面板显示未完成任务数和最长停留时间
5. **任务折叠**: 当某列任务超过6个时，点击"显示更多"按钮展开查看

### 管理员
1. **登录**: 使用默认管理员账户登录
2. **进入后台**: 点击右上角"管理后台"按钮
3. **用户管理**: 
   - 创建新用户账户
   - 删除用户（默认管理员不可删除）
   - 快速给用户分配任务
4. **任务管理**: 
   - 查看所有用户的任务
   - 给指定用户分配任务
5. **数据统计**: 
   - 查看每日完成任务数量和详情
   - 查看每个用户的任务完成情况

## 数据库结构

### users 表
- `id`: 用户ID（主键）
- `username`: 用户名（唯一）
- `password`: 加密密码
- `hero_name`: 英雄身份
- `role`: 角色（admin/user）
- `created_at`: 创建时间

### todos 表
- `id`: 任务ID（主键）
- `user_id`: 所属用户ID
- `title`: 任务标题
- `description`: 任务描述
- `status`: 任务状态
- `priority`: 优先级
- `column_type`: 所在列（todo/progress/completed）
- `assigned_by`: 分配人ID（管理员分配时）
- `created_at`: 创建时间
- `completed_at`: 完成时间

## 特色功能

- **现代化界面**: 深蓝色科技风格界面
- **响应式设计**: 支持桌面和移动设备
- **实时更新**: 任务时间和统计信息实时更新
- **拖拽交互**: 直观的拖拽操作体验
- **优先级可视化**: 不同颜色标识任务优先级
- **智能折叠**: 任务列表自动折叠，保持界面整洁
- **权限管理**: 管理员和普通用户分离
- **任务分发**: 管理员可以给团队成员分配任务
- **数据统计**: 完善的任务完成情况统计

## 安全特性

- 密码使用 bcrypt 加密存储
- Session 会话管理
- API 权限验证
- 防止 SQL 注入（使用参数化查询）
- 默认管理员账户保护

## 注意事项

- 默认管理员账户（ID=1）不能被删除
- 管理员可以创建其他管理员账户
- 任务折叠功能在每列超过6个任务时自动启用
- 首次运行会自动创建数据库和默认管理员账户

## 开发计划

- [x] 添加管理员系统
- [x] 任务分发功能
- [x] 数据统计功能
- [x] 任务折叠功能
- [ ] 添加任务提醒功能
- [ ] 支持任务标签和分类
- [ ] 数据导出功能
- [ ] 移动端 PWA 支持
