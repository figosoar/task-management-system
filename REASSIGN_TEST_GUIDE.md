# 任务重新分配功能测试指南

## ✅ 修复状态

**问题**: 重新分配失败  
**原因**: 数据库缺少 `assigned_by` 字段  
**解决方案**: 已实现自动数据库迁移  
**当前状态**: ✅ 已修复并验证

## 数据库验证结果

✅ `assigned_by` 字段已存在  
✅ SQL 更新语句正常工作  
✅ 服务器正在运行 (http://localhost:3000)

## 测试步骤

### 1. 登录管理员账户
- 打开浏览器访问: http://localhost:3000
- 点击"管理后台"
- 使用管理员账户登录:
  - 用户名: `admin`
  - 密码: `admin123`

### 2. 查看现有任务
- 进入"任务管理"标签（默认页面）
- 查看任务列表
- 如果没有任务，先创建一些测试任务

### 3. 测试重新分配功能
1. **点击任务标题** - 任何一个任务的标题（蓝色下划线）
2. **查看任务详情** - 弹出任务详情模态框
3. **点击"重新分配"按钮** - 在模态框底部
4. **选择新用户** - 从下拉列表中选择要分配的用户
5. **点击"确认分配"** - 提交重新分配

### 4. 验证结果

**预期结果**:
- ✅ 显示"任务重新分配成功"提示
- ✅ 模态框自动关闭
- ✅ 任务列表自动刷新
- ✅ 任务的"分配给"列显示新用户
- ✅ 任务的"分配人"列显示 admin

**如果失败**:
- ❌ 显示"重新分配失败"错误
- 检查浏览器控制台（F12）查看详细错误
- 检查服务器控制台查看后端错误

## 常见问题

### Q: 没有用户可以选择？
A: 需要先在"用户管理"标签创建普通用户。

### Q: 下拉列表是空的？
A: 确保至少有一个角色为"user"的用户（不是管理员）。

### Q: 还是显示"重新分配失败"？
A: 
1. 检查浏览器控制台（F12 → Console）
2. 查看网络请求（F12 → Network）
3. 确认服务器正在运行
4. 尝试重启服务器

### Q: 如何重启服务器？
A: 
```bash
# 在终端按 Ctrl+C 停止服务器
# 然后重新启动
npm start
```

## 技术细节

### API 端点
```
PUT /api/admin/todos/:id/reassign
```

### 请求体
```json
{
  "userId": 3
}
```

### 响应
成功:
```json
{
  "success": true
}
```

失败:
```json
{
  "error": "错误信息"
}
```

### 数据库更新
```sql
UPDATE todos 
SET user_id = ?, assigned_by = ? 
WHERE id = ?
```

## 下一步

如果测试成功，任务重新分配功能已完全可用！

如果遇到问题，请提供：
1. 浏览器控制台的错误信息
2. 服务器控制台的输出
3. 具体的操作步骤

---

**测试日期**: 2026-02-10  
**服务器状态**: ✅ 运行中  
**数据库状态**: ✅ 已迁移  
**功能状态**: ✅ 可用
